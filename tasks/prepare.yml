---
- name: Subscribe to rhel-7-server-cert-rpms
  become: True
  shell: subscription-manager repos --enable=rhel-7-server-cert-rpms
  register: rhsm
  until: rhsm.rc == 0
  retries: 5
  delay: 10
  when: openstack_certification_enable_rhsm_repo

- name: Copy an openstack certification repository
  become: True
  copy:
    src: "{{ openstack_certification_repo_file }}"
    dest: /etc/yum.repos.d/{{ openstack_certification_repo_file | basename }}
  when: openstack_certification_repo_file is defined

- name: Install Red Hat certification packages
  become: True
  package:
    name: "{{ openstack_certification_install_rpms }}"
    state: present

- name: Test if rhosp-release is available (OSP10 and above)
  package:
    list: rhosp-release
  register: rhosp_status

- name: Install rhosp-release
  become: True
  package:
    name: rhosp-release
    state: latest
  when: rhosp_status.results|length >= 1
